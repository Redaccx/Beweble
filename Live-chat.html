<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User1</title>
    <link rel="shortcut icon" href="" type="image/x-icon">
    <link rel="stylesheet" href="card.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
</head>

<body>
    <div class="vh-100 card bg-black p-0 border-0">
        <div class="card-header bg-dark d-flex gap-3 align-items-center text-white rounded-0">
        	<a href="main" >
        	       <i style='color:#ffd36a ;font-size:20px;' class="bi bi-chevron-left"></i></a>
        	        <h2 style='color:#fff ;font-size:15px;'class="m-0">beweble</h2>
     
    
        </div>
        <div id="message" class="card-body flex-grow-1 py-3 d-flex flex-column gap-1">
        </div>
        
            <form class="w-100 card-footer d-flex w-100 gap-2 bg-dark rounded-0" id="form">
                <input type="hidden" id="user" name="user" value="1">
                <input class="w-100 btn btn-light text-start rounded-5" id="msg" name="name" type="text" minlength="1" maxlength="400" class="" placeholder="message" required>
                
                <button :" id="sentbutton" type="submit" class="btn btn-success">
                    <i style="color:#ffd36a" class="bi bi-send"></i>
                </button>
            </form>
    </div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
    crossorigin="anonymous"></script>
<script >
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
import { getFirestore, getDocs, addDoc, collection, query, orderBy, limit} from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";

function getCurrentTimestamp () {
  return Date.now()
}

const firebaseConfig = {
    apiKey: "AIzaSyCfvhRy9HTtWjqPSKY9ik6ctTxdh4N3ri8",
    authDomain: "simplechat-afc0f.firebaseapp.com",
    projectId: "simplechat-afc0f",
    storageBucket: "simplechat-afc0f.appspot.com",
    messagingSenderId: "1082367455809",
    appId: "1:1082367455809:web:cedb50dbb0403d65ba8cc0"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const userID = document.getElementById('user').value;
const paragraph = document.getElementById("message");
let arr = [];
let i=0;

document.getElementById("form").onsubmit = async function (e) {
    
    e.preventDefault();
    const msg = document.getElementById("msg").value;
    document.getElementById('msg').value = " ";
    //var currentdate = new Date().toLocaleString();
 var currentdate= getCurrentTimestamp();
    const docRef = await addDoc(collection(db, "chaty"), {
        user: document.getElementById('user').value,
        msg: msg,
        time: currentdate
    });
    console.log("Document written with ID: ", docRef.id);
    loadmyself();
}
const loadmyself = async function () {
    const querySnapshot = await getDocs(collection(db, "chaty"));
    arr = [];
    i = 0;
    querySnapshot.forEach((doc) => {
        // console.table(doc.data());
        arr[i++] = doc.data();
    });
    displayArr();
    paragraph.scrollTop = paragraph.scrollHeight;
}

// document.getElementById("deleteAll").onclick = async function (e) {
//     const querySnapshot = await getDocs(collection(db, "chaty"));
//     const batch = db.batch();
//     querySnapshot.docs.forEach((doc) => {
//         batch.delete(doc.ref);
//     });
//   await batch.commit();
// }

function displayArr (){
    var sortedDesc = arr.sort(
      (objA, objB) => Number(objA.time) - Number(objB.time),);
     //sortedDesc.reverse();
    //arr.sort((a,b) => (a.time > b.time) ? 1 : ((b.time > a.time) ? -1 : 0));
    paragraph.innerHTML = " ";
    sortedDesc.forEach(value=>{
        var data = value.msg;
        if (value.user === userID) {
            paragraph.innerHTML += "<hard>" + data + "</hard>";
        }
        else {
            paragraph.innerHTML += "<span>" + data + "</span>";
        }
    })
}
const intervals = setInterval(async function () {
   await loadmyself();
}, 5000);
window.onload = async function () {
    await loadmyself();
}
</script>
</body>
</html>
